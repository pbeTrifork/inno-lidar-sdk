project(innolidarutils)
cmake_minimum_required(VERSION 3.0...3.28)


if((NOT "${ARCH_TAG}" STREQUAL "-arm" AND NOT "${ARCH_TAG}" STREQUAL "-qnx") OR NOT DEFINED ARCH_TAG)
    add_definitions(-DHAVE_SSE42)
endif()
    message(STATUS "The Arch is ${ARCH_TAG}")
aux_source_directory(. DIR_SRCS)

# UNIX system but not MACOS
if(CMAKE_HOST_UNIX)
    if(NOT CMAKE_SYSTEM_NAME MATCHES "Darwin")
        set(IS_ARM_ARCH OFF)
        if(CMAKE_SYSTEM_PROCESSOR MATCHES "(arm)|(aarch64)")
            set(IS_ARM_ARCH ON)
        else()
            if (ARCH_TAG)
                if (${ARCH_TAG} STREQUAL "-arm")
                    set(IS_ARM_ARCH ON)
                endif()
            endif()
        endif()
        if(IS_ARM_ARCH)
            if(NOT DEFINED MARCH_VALUE)
                set(MARCH_VALUE "armv8-a+crc")
            endif()
            if(NOT DEFINED MTUNE_VALUE)
                set(MTUNE_VALUE "cortex-a53")
            endif()

            set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -march=${MARCH_VALUE} -mtune=${MTUNE_VALUE} -DARCH_ARM64")
        else()
            if(IS_QNX)
                set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS}")
            else()
                set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -msse4.2")
            endif()
        endif()

    else() #(CMAKE_SYSTEM_NAME MATCHES "Darwin")
        if(NOT CMAKE_SYSTEM_PROCESSOR MATCHES "(arm)|(aarch64)")
            set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -msse4.2")
        endif()
    endif()
endif()

target_sources(inno_client_sdk PRIVATE ${DIR_SRCS})
